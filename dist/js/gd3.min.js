function mutation_matrix(t){function e(t){t.each(function(e){function n(t,e,n,r,a){function i(t,e){if(t.snid in l){var n=l[t.snid].genes.map(function(t){return t.gene});e.genes.forEach(function(e){-1==n.indexOf(e.gene)&&l[t.snid].genes.push(e)})}else l[t.snid]=e}var o={},l={};Re={},$e={},Ye={},Ve={},n.forEach(function(t){$e[t]=0,Ve[t]={}}),r.forEach(function(t){Ye[t.snid]=Number.POSITIVE_INFINITY}),r.forEach(function(r){var l={_id:r._id,name:r.name,snid:r.snid,genes:[],dataset:a[r._id]};if(!B[a[r._id]])return l.cooccurring=!1,void i(r,l);var s=[];n.forEach(function(n){var i=[];if(-1!=e[n].indexOf(r._id)){mutated=!1;var c=t[n][r._id].filter(function(t){return S[t]}).sort(function(t,e){return Fe[t]<Fe[e]?1:-1});if(c.forEach(function(t){l.genes.push({gene:n,dataset:a[r._id],ty:t,sample:r,mutTys:c}),mutated=!0,i.push(t),T[t]=!0,-1==s.indexOf(n)&&s.push(n)}),mutated){$e[n]+=1,o[r.snid]=!0,Ye[r.snid]=d3.min([Ye[r.snid],Be[n]]);var d=d3.min(i.map(function(t){return Fe[t]}));Ve[n][r.snid]=d3.min([d,Ve[n][r.snid]])}}}),l.cooccurring=Re[r.snid]=s.length>1,l.genes.forEach(function(t){t.cooccurring=l.cooccurring}),i(r,l)});var s=[];Object.keys(l).forEach(function(t){s.push(l[t])});var c=Object.keys(o).length;return{sampleMutations:s,coverage:c,geneToFreq:$e,sampleToExclusivity:Re,sampleToGeneIndex:Ye,geneToSampleMutationType:Ve}}function r(t,e,n,r){function a(t,e){return d3.ascending(n[t.snid],n[e.snid])}function i(t,e){return d3.ascending(r[t.snid],r[e.snid])}function o(t,r){var a=n[t.snid],i=n[r.snid];if(a<e.length)var o=Ve[e[a]][t.snid];if(i<e.length)var l=Ve[e[i]][r.snid];return o>l?1:o==l?0:-1}function l(t,e){return d3.ascending(t.name,e.name)}function s(t,e){return d3.ascending(ie[t._id],ie[e._id])}var c={};return c[Ge]=i,c[Xe]=a,c[je]=o,c[Ne]=l,c[De]=s,d3.range(0,fe).sort(function(e,n){var r,a=ue[e],i=ue[n];for(k=0;k<t.length;k++)if(r=c[t[k]](a,i),0!=r)return r;return r})}function h(){mutationData=n(ae,Le,ce,se,ie),Pe=mutationData.sampleMutations,Ye=mutationData.sampleToGeneIndex,Re=mutationData.sampleToExclusivity,$e=mutationData.geneToFreq,qe=mutationData.coverage,Ve=mutationData.geneToSampleMutationType;var t=r(Ue,Ie,Ye,Re);H={};for(var e=0;fe>e;e++)H[ue[t[e]].snid]=e}function z(t){return"del"==t}function R(t){return"amp"==t}function V(t){return"snv"==t}function q(t){return"other"==t}function U(t){return"inactive_snv"==t}function J(t){return"fus"==t}function K(){function t(t){return en(H[t])>=m+s&&en(H[t])<=xe}function e(e){return t(e.sample.snid)&&S[e.ty]&&B[ie[e.sample._id]]}var n=un.filter(function(e){return t(e.snid)}).style("fill-opacity",1).style("stroke-opacity",1);un.filter(function(e){return!t(e.snid)}).style("fill-opacity",.25).style("stroke-opacity",1),on.style("opacity",function(e){var n=t(e.snid),r=B[ie[e._id]];return n&&r?1:.25}),fn.style("opacity",0).style("stroke-opacity",0),fn.filter(function(t){return e(t)}).style("opacity",1).style("stroke-opacity",1),fn.filter(function(t){return!e(t)&&S[t.ty]&&B[ie[t.sample._id]]}).style("opacity",.25).style("stroke-opacity",.25);var r=n[0].length,a=xe-m-s;for(ge=1;4>ge*a/r;)ge+=1;he=a/r,hn.attr("width",he).attr("y",function(t){var e=Be[t.gene]?Be[t.gene]:0;return(e+.375)*g}),gn.attr("transform",function(t){var e=he/2,n=(Be[t.gene]?Be[t.gene]:0)*g+g/2,r=he/6,a="translate("+e+","+n+")",i="rotate(90)",o="scale("+r+")";return a+","+i+","+o}),xn.attr("x2",he).attr("transform",function(t){var e=(Be[t.gene]?Be[t.gene]:0)*g;return"translate(0,"+e+")"}),cn.attr("transform",function(t){return"translate("+en(H[t.snid])+")"}),on.attr("transform",function(t){return"translate("+en(H[t.snid])+","+rn+")rotate(90)"}),cn.selectAll("text").style("font-size",8>he?he:8).attr("transform","translate("+he/2+","+(y+pe*g)+"), rotate(-90)"),_.attr("width",he).attr("height",function(t){return z(t.ty)||R(t.ty)?g/2:g}).attr("y",function(t){var e=Be[t.gene]?Be[t.gene]:0,n=z(t.ty)?g/2:0;return t.y=e*g+n}),d3.select("rect#sampleWidthRect").attr("width",ge*he-2*b);var i=1==ge?"sample":"samples";if(d3.select("text#sampleWidthText").attr("transform","translate("+(he+5)+",0)").text(ge+" "+i),Y){{L.sampleToAnnotations,L.annotationToColor||{}}pn.each(function(e){var n=(e.name,d3.select(this)),r=t(e.snid),a=B[ie[e._id]];n.selectAll("rect").attr("width",he).style("opacity",r&&a?1:a?.1:0)})}Je.selectAll(".vert-line").remove();var o=cn.data().map(function(t,e){return e}).filter(function(t){return en(t)>=m+s&&en(t)<=xe}).filter(function(t,e){return e%ge==0});Je.selectAll(".vert-line").data(o).enter().append("line").attr("x1",-be).attr("y1",s).attr("y2",s).attr("class","vert-line").attr("transform",function(t){return"translate("+en(t)+","+s+"), rotate(-90)"}).style("stroke","#fff").style("stroke-width",b)}function Q(){return(100*qe/we).toFixed(2)+"% ("+qe+"/"+we+")"}function Z(){var e=t.append("div").style("float","right").style("font-size","14px").style("margin-right",(D?me-Cn:0)+"px");e.append("b").text("Coverage: "),Tn=e.append("span").text(Q())}function te(t,e){var n=B[e],r=n?.5:1;d3.select(t).selectAll("*").style("fill-opacity",r).style("stroke-opacity",r),B[e]=!n,C()}function ee(){if(ye){var e=15,n=t.insert("svg","svg").attr("id","sample-type-legend").attr("width",me-Cn).attr("height",ve).style("float","right").style("margin-left",Cn).style("margin-bottom",10).style("font-size",10);n.append("text").attr("x",2).attr("y",10).style("font-weight","bold").text("Sample Types");var r=n.selectAll(".dataset-legend").data(oe).enter().append("g").attr("transform",function(t,n){return"translate(2,"+(n+1)*e+")"}).style("cursor","pointer").on("click",function(t){te(this,t)});r.append("rect").attr("width",e).attr("height",e).style("fill",function(t){return A[t]}),r.append("text").attr("dy",e-3).attr("dx",20).text(function(t){return t})}}function ne(){var e=10,n=11,r=e/2,a=t.append("div").append("a").text("Legend [+]").attr("id","mutmtx-mutLegend-title").style("font-weight","bold").style("font-size","14px").style("margin-left",m+"px").on("click",function(){d3.event.preventDefault()});a.on("mouseover",function(){function t(){function t(t,e){var n=S[e],r=n?.5:1;d3.select(t).selectAll("*").style("fill-opacity",r).style("stroke-opacity",r),S[e]=!n,C()}_n.append("b").text("Aberrations"),_n.append("br");var a=_n.append("svg").attr("id","mutation-legend").attr("height",x),l=a.append("g").style("font-size",n);if(r=e/2,ye||(l.append("rect").attr("x",r).attr("height",g).attr("width",e).style("fill",u),l.append("text").attr("x",e+10).attr("y",3*g/4).style("fill","#000").text("Exclusive"),r+=e+10+65,l.append("rect").attr("x",r).attr("height",g).attr("width",e).style("fill",d),l.append("text").attr("x",r+e+10).attr("y",3*g/4).style("fill","#000").text("Co-occurring"),r+=e+10+85),T.snv){var s=l.append("g").attr("transform","translate("+r+",0)").style("cursor","pointer").on("click",function(){t(this,"snv")});r+=e+10+10+25}if(T.inactive_snv){var c=l.append("g").attr("transform","translate("+r+",0)").style("cursor","pointer").on("click",function(){t(this,"inactive_snv")});r+=e+10+75}if(T.del){var f=l.append("g").attr("transform","translate("+r+",0)").style("cursor","pointer").on("click",function(){t(this,"del")});r+=e+10+55}if(T.amp){var p=l.append("g").attr("transform","translate("+r+",0)").style("cursor","pointer").on("click",function(){t(this,"amp")});r+=e+10+75}if(T.fus){var h=l.append("g").attr("transform","translate("+r+",0)").style("cursor","pointer").on("click",function(){t(this,"fus")});r+=e+10+220}T.snv&&(s.append("rect").attr("height",g).attr("width",e).style("fill",o),s.append("text").attr("dx",e+10).attr("dy",3*g/4).style("fill","#000").text("SNV")),T.inactive_snv&&(c.append("rect").attr("height",g).attr("width",e).style("fill",o),c.append("rect").attr("y",3*g/8).attr("height",g/4).attr("width",e).style("fill","#000"),c.append("text").attr("dx",e+10).attr("dy",3*g/4).style("fill","#000").text("Inactivating")),T.del&&(f.append("rect").attr("y",g/2).attr("height",g/2).attr("width",e).style("fill",o),f.append("text").attr("dx",e+5).attr("dy",3*g/4).style("fill","#000").text("Deletion")),T.amp&&(p.append("rect").attr("height",g/2).attr("width",e).style("fill",o),p.append("text").attr("dx",e+10).attr("dy",3*g/4).style("fill","#000").text("Amplification")),T.fus&&(h.append("path").attr("d",d3.svg.symbol().type("triangle-up").size(30)).attr("transform","translate(0,"+3*g/8+")rotate(90)").style("stroke",i).style("fill",o),h.append("text").attr("dx",e+10).attr("dy",3*g/4).style("fill","#000").text("Fusion/Rearrangement/Splice Variant")),l.append("rect").attr("x",r).attr("id","sampleWidthRect").attr("width",ge*he-2*b).attr("height",g).style("fill",o),l.append("text").attr("id","sampleWidthText").attr("x",r).attr("y",3*g/4).attr("transform","translate("+(he+5)+",0)").style("fill","#000").text(1==ge?"1 sample":ge+" samples"),a.attr("width",l.node().getBBox().width)}var a=$("#mutmtx-mutLegend-title").position();if(_n=d3.select("body").append("div").attr("id","mutmtx-mutLegend-tip").style("background","#fff").style("border","1px solid #ccc").style("padding","10px").style("position","absolute").style("top",a.top+15+"px").style("left",a.left+"px").style("max-width","500px"),t(),Y){if(_n.append("br"),_n.append("b").text("Sample annotations"),_n.append("br"),P){var l=_n.append("div").style("display","inline-block").style("padding","5px").style("font-size","12px");l.append("div").style("background-color","#333").style("display","inline-block").style("height","12px").style("width","12px").style("margin-right","5px"),l.append("div").style("display","inline-block").text("No data")}{var s=_n.selectAll(".category").data(Ce).enter().append("p").filter(function(t){return"Cancer type"!==t}).style("margin","0px").style("font-size","12px").text(function(t){return t});s.filter(function(t){return void 0==Oe[t]?!1:"ordinal"!==Oe[t].type}).append("div").each(function(t,e){var n=d3.select(this),r=Oe[t];n.append("span").style("margin-right","10px").text(d3.min(r.domain()));var a=n.append("svg").style("width",80).style("height",15);n.append("span").style("margin-left","10px").text(d3.max(r.domain()));var i=a.append("svg:defs").append("svg:linearGradient").attr("id","gradient"+e).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");i.append("svg:stop").attr("offset","0%").attr("stop-color",r(d3.min(r.domain()))).attr("stop-opacity",1),i.append("svg:stop").attr("offset","100%").attr("stop-color",r(d3.max(r.domain()))).attr("stop-opacity",1),a.append("rect").attr("width",80).attr("height",15).style("fill","url(#gradient"+e+")")})}s.append("br");var c=s.filter(function(t){return void 0==Oe[t]?!1:"ordinal"===Oe[t].type}).selectAll(".annotation").data(function(t){return Te[t]}).enter().append("div").style("display","inline-block").style("padding","5px");c.append("div").style("background-color",function(t){return Oe[t.cat](t.ann)}).style("display","inline-block").style("height","12px").style("width","12px").style("margin-right","5px"),c.append("div").style("display","inline-block").text(function(t){return t.ann})}}),a.on("mouseout",function(){d3.select("#mutation-legend").remove(),_n.remove(),_n=null})}function re(){function e(t){for(var e=r(t,Ie,Ye,Re),n=0;fe>n;n++)H[ue[e[n]].snid]=n;cn.transition().duration(a).delay(function(t){return en(H[t.snid])}).attr("transform",function(t){return"translate("+en(H[t.snid])+",0)"}),i()}function n(t,n){var r=Ue,a=Ue.indexOf(t),i=a-n;-1!=i&&i<Ue.length&&(r[a]=r[i],r[i]=t),e(r)}function i(){s.selectAll("*").remove();var t=s.selectAll(".sort-fn").data(Ue).enter().append("li").style("list-style-type","none").style("margin-bottom","5px");t.append("span").style("cursor","pointer").html("&darr;").on("mouseover",function(){d3.select(this).style("color","red")}).on("mouseout",function(){d3.select(this).style("color","black")}).on("click",function(t){n(t,-1)}),t.append("span").style("cursor","pointer").html("&uarr;").on("mouseover",function(){d3.select(this).style("color","red")}).on("mouseout",function(){d3.select(this).style("color","black")}).on("click",function(t){n(t,1)}),t.append("span").text(function(t){We[t];return" "+We[t]})}var o=t.append("div").attr("id","sample-sorting-interface").style("margin-left",m+"px").style("font-size","12px"),l=o.append("a").style("font-weight","bold").style("font-size","14px").text("Sort mutation matrix by: ").on("click",function(){$("ul#sample-sort-list").is(":visible")?($("ul#sample-sort-list").slideUp(),$("span#interface-status").html("&uarr;")):($("ul#sample-sort-list").slideDown(),$("span#interface-status").html("&darr;"))});l.append("span").attr("id","interface-status").style("cursor","pointer").html("&uarr;");var s=o.append("ul").attr("id","sample-sort-list").style("padding-left","10px").style("display","none");i()}{var ae=e.M||{},ie=e.sampleToTypes||{},oe=e.sampleTypes||[],le=e.typeToSamples||{},se=e.samples,ce=Object.keys(ae);ce.length}se||(se=Object.keys(ie).map(function(t){return{_id:t,name:t,z_index:1}})),se.forEach(function(t){t.snid=X?t._id:t.name});var de={};se.sort(function(t,e){return d3.ascending(t.z_index,e.z_index)}),se.forEach(function(t){de[t.snid]||(de[t.snid]=t)});var ue=[];Object.keys(de).forEach(function(t){ue.push(de[t])});for(var fe=ue.length,pe=0;pe<se.length;pe++)-1==oe.indexOf(ie[se[pe]._id])&&oe.push(ie[se[pe]._id]);oe.sort(),oe.forEach(function(t){B[t]=!0});var he,ge,ye=oe.length>1&&c,me=ye?100:0,ve=ye?15*(oe.length+1):0,xe=p-(D?me:0),be=ce.length*g+s,ke=be;if(X)var we=oe.reduce(function(t,e){return t+le[e].length},0);else{var Ae={};oe.forEach(function(t){le[t].forEach(function(t){Ae[t]=!0})});var we=Object.keys(Ae).length}var ze=oe.reduce(function(t,e){return A[e]?t+1:t},0);if(ze!=oe.length)for(var Se=d3.scale.category20(),pe=0;pe<oe.length;pe++)A[oe[pe]]||(A[oe[pe]]=Se(pe));var Te={};if(Y){var Ce=L.categories||[],_e=L.sampleToAnnotations||{},Ee=L.annotationToColor||{},Me=Object.keys(L.sampleToAnnotations)[0];numAnnTypes=L.sampleToAnnotations[Me].length,ke=be,be+=numAnnTypes*(g+w);var Oe={};Ce.forEach(function(t,e){var n=!0,r=[],a=[];Object.keys(_e).forEach(function(t){var i=typeof _e[t][e],o=_e[t][e];n=n&&(null==o||""==o||"number"===i),""!=o&&null!=o?(r.push(o),n&&a.push(_e[t][e])):P=!0});var i,o={min:d3.min(a),max:d3.max(a)};if(n){var l=f[I];i=d3.scale.linear().domain([o.min,o.max]).range(l).interpolate(d3.interpolateLab),i.type="linear",I+=1,I>=f.length&&(I=0)}else{var s=r.filter(function(t,e){return r.indexOf(t)==e}),c=s.map(function(e){return Ee[t]&&Ee[t][e]?Ee[t][e]:"#"+Math.floor(16777215*Math.random()).toString(16)});Te[t]=s.map(function(e){return{cat:t,ann:e}}),i=d3.scale.ordinal().domain(s).range(c),i.type="ordinal"}Oe[t]=i})}var He=be+y;Y&&(He+=Ce.length*g/2+3*w);var Le={};for(pe=0;pe<ce.length;pe++)Le[ce[pe]]=Object.keys(ae[ce[pe]]);var Be={},Ie=ce.sort(function(t,e){return Le[t].length<Le[e].length?1:-1});d3.range(0,ce.length).forEach(function(t){Be[Ie[t]]=t});var Fe={fus:0,inactive_snv:1,snv:2,amp:3,del:4,other:5},De=0,Ne=1,je=2,Ge=3,Xe=4,We={};We[Ge]="Exclusivity",We[Xe]="Gene frequency",We[je]="Mutation type",We[Ne]="Sample name",We[De]="Sample type";var Pe,Ye,Re,$e,Ve,qe,Ue=[Xe,De,Ge,je,Ne];h();var Je=d3.select(this).selectAll("svg").data([e]).enter().append("svg"),Ke=Je.append("g").attr("transform","translate("+s+","+s+")"),Qe=Ke.selectAll(".geneLabels").data(ce).enter().append("svg:g").attr("class","geneLabel").attr("transform",function(t){return"translate(0,"+Be[t]*g+")"}),Ze=Qe.append("text").attr("class","gene-name").attr("font-size",14).attr("text-anchor","end").text(function(t){return t+" ("+$e[t]+")"}),tn=0;Ze.each(function(){var t=d3.select(this).node().getBBox().width;tn=tn>t?tn:t}),m=tn,Ze.attr("transform",function(){return"translate("+m+","+(g-s)+")"});var en=d3.scale.linear().domain([0,fe]).range([m+s,xe-s]);Je.attr("id","mutation-matrix").attr("width",xe).attr("height",He).attr("xmlns","http://www.w3.org/2000/svg");var nn=Ke.append("rect").style("fill",i).attr("width",xe-m-s).attr("height",ke).attr("transform","translate("+(m+s)+",0)"),rn=g*ce.length+3*w;Y&&(rn+=2*w+Ce.length*(g/2+w));var an=Ke.append("svg:g"),on=an.selectAll(".sample-label").data(Pe).enter().append("text").attr("fill",o).attr("text-anchor","start").style("font-size","10px").text(function(t){return t.name}),ln=an.append("text").attr("y",rn+10).attr("text-anchor","end").attr("x",m).style("font-size","12px").text("Sample IDs"),sn=Ke.append("svg:g").attr("id","mutation-matrix"),cn=sn.selectAll(".sample").data(Pe).enter().append("svg:g").attr("class","sample").attr("id",function(t){return t.name});en=d3.scale.linear().domain([0,fe]).range([m+s,xe-s]),nn.attr("transform","translate("+m+",0)");var dn=Ke.selectAll(".horizontal-line").data(ce).enter().append("line").attr("x2",xe-m).attr("transform",function(t,e){var n=m+s,r=e*g;return"translate("+n+","+r+")"}).style("stroke","#fff"),un=cn.append("g").attr("transform","translate(0,0)"),fn=un.selectAll(".muts").data(function(t){return t.genes}).enter().append("g");_=fn.append("rect").attr("class",function(t){return"tick "+t.ty}).attr("fill",function(t){return ye?J(t.ty)&&V(t.ty)?i:A[t.dataset]:J(t.ty)&&V(t.ty)?i:t.cooccurring?d:u});var pn,hn=fn.append("rect").filter(function(t){return U(t.ty)}).attr("class","inactivating").attr("width",he).attr("height",g/4).style("fill",l),gn=fn.append("svg:path").filter(function(t){return J(t.ty)}).attr("class","fusion").attr("d",d3.svg.symbol().type("triangle-up").size(8)).style("stroke-opacity",0).style("fill",function(t){return ye?A[t.dataset]:t.cooccurring?d:u});if(Y){var yn=g*ce.length+3*w;pn=cn.append("g").attr("transform","translate(0,"+yn+")");var mn=Ke.append("g"),vn=mn.selectAll("text").data(L.categories).enter().append("text").attr("text-anchor","end").attr("width",Ze.node().getBBox().width).attr("x",m).attr("y",function(t,e){return yn+e*(w+g/2)+g/2}).style("font-size",12).text(function(t){return t});pn.each(function(t){var e=t.name,n=d3.select(this);_e[e]&&n.selectAll("rect").data(_e[e]).enter().append("rect").attr("height",g/2).attr("x",0).attr("y",function(t,e){return(w+g/2)*e}).style("fill",function(t,e){return""==t||null==t?"#333":Oe[Ce[e]](t)}).append("title").text(function(t){return""==t||null==t?e+": No data":e+": "+t})}),vn.each(function(){var t=d3.select(this).node().getBBox().width;tn=tn>t?tn:t}),m=tn,en=d3.scale.linear().domain([0,fe]).range([m+s,xe-s]),dn.attr("transform",function(t,e){var n=m+s,r=e*g;return"translate("+n+","+r+")"}),nn.attr("transform","translate("+m+",0)"),vn.attr("x",m),ln.attr("x",m),Ze.attr("transform",function(){return"translate("+m+","+(g-s)+")"})}var xn=fn.append("line").filter(function(t){return q(t.ty)}).attr("class","other").attr("x1",function(){return 0}).attr("y1",function(){return 0}).attr("y2",function(){return g}).style("stroke","#000").style("stroke-width",2);if(G){M=d3.tip().attr("class","d3-tip").offset([-10,0]).html(E),Je.call(M);var bn="div.gd3-tooltip",kn=function(t,e){d3.select(bn+" div.more-info").style("display",t?"inline":"none"),d3.select(bn+" div.less-info").style("display",e?"inline":"none")},wn=function(t){M.hide(t),d3.select(this).on("mouseout",function(){M.hide(t)}),kn(!1,!0)},An=function(t){M.show(t),d3.select(bn).insert("span",":first-child").style("cursor","pointer").style("float","right").attr("class","x").on("click",wn).text("X")},zn=function(t){An(t),kn(!0,!1)};fn.on("mouseover",An).on("mouseout",M.hide).on("click",function(t){zn(t),d3.select(this).on("mouseout",zn),W&&O(t,pe)})}else W&&fn.on("click",O);var Sn=d3.behavior.zoom().x(en).scaleExtent([1,Math.round(v*fe/xe)]).on("zoom",function(){K()});Je.call(Sn);var Tn,Cn=10;C=function(){h(),Ze.text(function(t){return t+" ("+$e[t]+")"}),Tn.text(Q()),K()};var _n=null;K(),Je.attr("height",Je.node().getBBox().height),F&&Z(),D&&ee(),N&&ne(),j&&re()})}var t=t||{},n=t.style||{},r=n.colorSchemes||{},a=n.animationSpeed||300,i=n.bgColor||"#F6F6F6",o=n.blockColorMedium||"#95A5A6",l=n.blockColorStrongest||"#2C3E50",s=n.boxMargin||5,c=n.colorSampleTypes||!0,d=n.coocurringColor||"orange",u=n.exclusiveColor||"blue",f=n.continuousScaleColors||[["#fcc5c0","#49006a"],["#ffffff","#000000"]],p=n.width||500,h=n.height||300,g=n.geneHeight||20,y=n.labelHeight||75,m=n.labelWidth||100,v=n.minBoxWidth||20,x=n.mutationLegendHeight||30,b=n.sampleStroke||1,w=n.sampleAnnotationSpacer||5,A=r.sampleType||{},z=t.mutationTypes||["snv","inactive_snv","del","amp","fus","other"],S={},T={};z.forEach(function(t){S[t]=!0,T[t]=!1});var C,_,E,M,O,H,L,B={},I=0,F=!1,D=!1,N=!1,j=!1,G=!1,X=!1,W=!1,P=!1,Y=!1;return e.addCoverage=function(){return F=!0,e},e.addSampleLegend=function(){return D=!0,e},e.addMutationLegend=function(){return N=!0,e},e.addSortingMenu=function(){return j=!0,e},e.addSampleAnnotations=function(t){return L=t||{},L.sampleToAnnotations&&(Y=!0),e},e.showDuplicates=function(){return X=!0,e},e.width=function(t){return arguments.length?(p=t,e):width},e.height=function(t){return arguments.length?(h=t,e):height},e.filterDatasets=function(t){Object.keys(t).forEach(function(e){B[e]=t[e]}),C()},e.addTooltips=function(t){return G=!0,E=t,_&&M&&M.html(t),e},e.addOnClick=function(t){return W=!0,O=t,e},e.sampleOrder=function(t){return arguments.length?H=t:H},e}function transcript_plot(t){function e(t){t.each(function(e){function n(){var n=Object.keys(v),r=n.length,a=Math.ceil(r/2),i=a*legendSymbolHeight,l=t.append("div").selectAll("svg").data([e]).enter().append("svg").attr("class","legend").attr("font-size",10).style("height",i+2*margin).style("width",width),s=l.selectAll(".symbolGroup").data(n).enter().append("g").attr("transform",function(t,e){var n=e%a*width/a+2*margin,i=Math.round(e/r)*legendSymbolHeight+(Math.round(e/r)+2)*margin;return"translate("+n+", "+i+")"}).style("cursor","pointer").on("click",function(t){var e=x[t],n=e?.5:1;d3.select(this).selectAll("*").style("fill-opacity",n).style("stroke-opacity",n),x[t]=!e,b()});s.append("path").attr("class","symbol").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[v[t]]}).size(2*legendSymbolHeight)).style("stroke",o).style("stroke-width",2).style("fill",o),s.append("text").attr("dx",7).attr("dy",3).text(function(t){return t.replace(/_/g," ")})}function r(){function t(t,e,n){t.attr("cy",e.y=n),e.z.translate([e.z.translate()[0],"up"==e.direction?e.scale(e.y):-e.scale(e.y)]),b()}function e(t,e){return"up"==t.direction?Math.max(t.y2,Math.min(t.y1,e)):Math.max(t.y1,Math.min(t.y2,e))}function n(n){d3.select(this).attr("opacity",.6),t(d3.select(this),n,e(n,d3.event.y))}function r(){d3.select(this).attr("opacity",1)}var a=5,i=8,o=5,l=4,s=B-2*i-2*margin;sliderRadius=4,sliderWidth=3,sliderMargin=margin+i;var c=[{x:margin,y1:sliderMargin+s,y2:sliderMargin,direction:"up",z:V,scale:$,name:"topSlider"},{x:margin,y1:height-sliderMargin-s,y2:height-sliderMargin,direction:"down",z:J,scale:U,name:"bottomSlider"}];c.forEach(function(t){t.y=t.y1,t.scale.domain([t.y1,t.y2])});var u=[{y:margin,increment:-a,symbol:o,slider:c[0]},{y:sliderMargin+2*margin+s,increment:a,symbol:l,slider:c[0]},{y:height-s-sliderMargin-2*margin,increment:-a,symbol:o,slider:c[1]},{y:height-margin,increment:a,symbol:l,scale:U,slider:c[1]}];I.selectAll(".button").data(u).enter().append("path").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[t.symbol]}).size(radius*radius)).attr("transform",function(t){return"translate("+margin+","+t.y+")"}).style("cursor","pointer").style("fill",d).on("click",function(n){var r=e(n.slider,n.slider.y+n.increment);t(d3.select("circle#"+n.slider.name),n.slider,r)});var f=d3.behavior.drag().origin(Object).on("drag",n).on("dragend",r),p=I.selectAll(".slider").data(c).enter().append("g");p.append("line").attr("x1",function(t){return t.x}).attr("x2",function(t){return t.x}).attr("y1",function(t){return t.y1}).attr("y2",function(t){return t.y2}).style("stroke","#C0C0C0").style("stroke-width",2),p.append("circle").attr("id",function(t){return t.name}).attr("r",sliderRadius).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y1}).attr("fill","#C0C0C0").style("cursor","pointer").call(f)}var T=e.gene,C=e.length,_=e.mutations,E=e.domains[a]||[],M=_.slice().map(function(t){return t.gene=T,t}),O=[];if(_.forEach(function(t){-1==O.indexOf(t.dataset)&&O.push(t.dataset)}),O.sort(),O.forEach(function(t){S[t]=!0}),0==Object.keys(z).length)for(var H=d3.scale.category20(),L=0;L<O.length;L++)z[O[L]]=H(L);var B=(height-genomeHeight-axisHeight-4*margin)/2,I=d3.select(this).selectAll("svg").data([e]).enter().append("svg").style("cursor","move");I.attr("class","transcript-box").attr("id",T+"-transcript").attr("width",width).attr("height",height+2*margin);var F=I.append("g"),D=(F.append("rect").attr("class","background").attr("width",width).attr("height",height).style("fill",c),B),N=(F.append("rect").attr("class","background").attr("id","background-top").attr("width",width-2*margin).attr("height",B).attr("x",margin).attr("y",margin).style("fill",c),B+genomeHeight+axisHeight+3.5*margin),j=(F.append("rect").attr("class","background").attr("id","background-bottom").attr("width",width-2*margin).attr("height",B).attr("x",margin).attr("y",B+genomeHeight+axisHeight+3*margin).style("fill",c),0),G=C,X=d3.scale.linear().domain([j,G]).range([margin,width-margin]),W=d3.behavior.zoom().x(X).scaleExtent([1,100]).on("zoom",function(){b()});F.call(W);var P=2*radius,Y=_.length,R=d3.scale.linear().domain([0,Y]).range([B,-1*P*Y+D]),$=d3.scale.linear().range([0,P*Y]),V=d3.behavior.zoom().y(R).scaleExtent([1,1]).on("zoom",function(){b()}),q=d3.scale.linear().domain([0,Y]).range([N,N+Y*P]),U=d3.scale.linear().range([0,P*Y]),J=d3.behavior.zoom().y(q).scaleExtent([1,1]).on("zoom",function(){b()}),K=2*margin+B,Q=F.append("rect").attr("class","transcript").attr("height",genomeHeight-margin).attr("width",X(G)-X(j)).attr("x",X(j)).attr("y",K+margin/2).style("fill",i),Z=d3.svg.axis().scale(X).orient("bottom").ticks(numTicks).tickSize(0).tickPadding(tickPadding),te=F.append("g").attr("class","xaxis").attr("transform","translate(5,"+(K+genomeHeight+margin)+")").style("font-size","12px").style("fill","#000").call(Z),ee=F.selectAll(".top-symbols").data(M.filter(function(t){return!m[t.ty]})).enter().append("path").attr("class","symbols").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[v[t.ty]]}).size(radius*radius)).style("fill",function(t){return z[t.dataset]}).style("stroke",function(t){return z[t.dataset]}).style("stroke-width",2).style("cursor","default"),ne=F.selectAll(".bottom-symbols").data(M.filter(function(t){return m[t.ty]})).enter().append("path").attr("class","symbols").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[v[t.ty]]}).size(radius*radius)).style("fill",function(t){return z[t.dataset]}).style("stroke",function(t){return z[t.dataset]}).style("stroke-width",2).style("cursor","default");if(h){var re=d3.tip().attr("class","d3-tip").offset([-10,0]).html(k);I.call(re),ne.on("mouseover",re.show).on("mouseout",re.hide),ee.on("mouseover",re.show).on("mouseout",re.hide),g&&(ne.on("click",function(t,e){w(t,e)}),ee.on("click",function(t,e){w(t,e)}))}else g&&(ee.on("click",w),ne.on("click",w));var E=E.map(function(t){return t.gene=T,t}),ae=F.selectAll(".domains").data(E).enter().append("g").attr("class","domains"),ie=ae.append("rect").attr("id",function(t,e){return"domain-"+e}).attr("width",function(t){return X(t.end)-X(t.start)}).attr("height",genomeHeight+margin).style("fill",o).style("fill-opacity",.5),oe=ae.append("text").attr("id",function(t,e){return"domain-label-"+e}).attr("text-anchor","middle").attr("y",genomeHeight).style("fill",s).style("fill-opacity",0).text(function(t){return t.name});ae.on("mouseover",function(t,e){d3.select(this).selectAll("rect").style("fill",l),F.select("#domain-label-"+e).style("fill-opacity",1)}).on("mouseout",function(t,e){d3.select(this).selectAll("rect").style("fill",o),F.select("#domain-label-"+e).style("fill-opacity",0)}),y&&ae.on("click",A),b=function(){function t(t,e,n,r,l){var s={};t.filter(function(t){return x[t.ty]&&S[t.dataset]}).each(function(t){var e=Math.round(t.locus/o);e in s?(yIndex=s[e],s[e]+=1):(yIndex=0,s[e]=1),t.x=X(e*o),t.y=n(yIndex)}),Y=d3.max(Object.keys(s),function(t){return s[t]}),e.range([0,P*Y]),t.attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("fill-opacity",1).style("stroke-opacity",1),t.filter(function(t){var e=r<t.y&&l>t.y&&a<t.locus&&i>t.locus,n=x[t.ty],o=S[t.dataset];return!(e&&n&&o)}).style("fill-opacity",0).style("stroke-opacity",0)}var e=W.translate(),n=(W.scale(),e[0]),r=e[1];n=Math.min(n,0),W.translate([n,r]);var a=d3.min(X.domain()),i=d3.max(X.domain()),o=Math.round((i-a)/u);o=o?o:1,t(ee,$,R,0,B+margin),t(ne,U,q,N-margin,height-2*margin),te.call(Z),Q.attr("x",X(j)).attr("width",X(G)-X(j)),ae.attr("transform",function(t){return"translate("+X(t.start)+","+(K-margin/2)+")"}),ie.attr("width",function(t){return X(t.end)-X(t.start)}),oe.attr("x",function(){var t=d3.select(this.parentNode).select("rect").attr("width");return t/2})},b(),f&&n(),p&&r()})}var t=t||{},n=t.style||{},r=n.colorSchemes||{},a=t.domainDB||"PFAM",i=n.blockColorLight||"#BDC3C7",o=n.blockColorMedium||"#95A5A6",l=n.highlightColor||"#f1c40f",s=n.textColorStrongest||"#2C3E50",c=n.bgColor||"#ffffff",d=n.buttonColor||"#666666";genomeHeight=n.genomeHeight||20,axisHeight=n.axisHeight||20,height=n.height||200,margin=n.margin||5,numTicks=n.numTicks||5,radius=n.radius||5,legendSymbolHeight=n.legendSymbolHeight||14,tickPadding=n.tickPadding||1.25,width=n.width||500;var u=Math.floor(width/(2*radius)),f=!1,p=!1,h=!1,g=!1,y=!1,m=t.inactivating||{Nonsense_Mutation:!0,Frame_Shift_Del:!0,Frame_Shift_Ins:!0,Missense_Mutation:!1,Splice_Site:!0,In_Frame_Del:!1,In_Frame_Ins:!1},v=t.mutSymbols||{Nonsense_Mutation:0,Frame_Shift_Del:1,Frame_Shift_Ins:1,Missense_Mutation:2,Splice_Site:3,In_Frame_Del:4,In_Frame_Ins:4},x={};Object.keys(v).forEach(function(t){x[t]=!0});var b,k,w,A,z=r.sampleType||{},S={};return e.addLegend=function(){return f=!0,e},e.addTooltips=function(t){return h=!0,k=t,e},e.addOnClickMutations=function(t){return g=!0,w=t,e},e.addOnClickDomains=function(t){return y=!0,A=t,e},e.addVerticalPanning=function(){return p=!0,e},e.filterDatasets=function(t){Object.keys(t).forEach(function(e){S[e]=t[e]}),b()},e}function subnetwork(t){function e(t){t.each(function(t){function e(){var t=w?k-Math.max(f+15,v):k-v,e=E.selectAll(".net-group").data(I).enter().append("g").attr("transform",function(e,n){return"translate("+t+","+(n+1)*m+")"}).style("font-size",12).on("click",function(t){var e=X[t];X[t]=!e,e||G[t].style("display","inline"),G[t].transition().duration(b).style("stroke-opacity",e?0:1),e&&setTimeout(function(){G[t].style("display","none")},b),d3.select(this).transition().duration(b).style("stroke-opacity",e?.5:1).style("fill-opacity",e?.5:1),z?(j.filter(function(t){return t.networks.reduce(function(t,e){return t+(X[e]?1:0)},0)>0}).on("mouseover",V).on("mouseout",R.hide).on("click",function(t,e){V(t),d3.select(this).on("mouseout",V),S&&n(t,e)}),j.filter(function(t){return 0==t.networks.reduce(function(t,e){return t+(X[e]?1:0)},0)}).on("mouseover",function(){}).on("mouseout",function(){})):S&&j.filter(function(t){return 0==t.networks.reduce(function(t,e){return t+(X[e]?1:0)},0)}).on("click",n)});e.append("line").attr("x1",0).attr("x2",m).style("stroke-width",l).style("stroke",function(t){return i.network[t]}),e.append("text").attr("x",8+m).attr("y",3).text(function(t){return t})}function a(){var t=w?18*I.length+15:10,e=w?k-Math.max(f+15,v):k-f-15,n=E.append("g").attr("id","subnetwork-legend").attr("transform","translate("+e+","+t+")");E.append("svg:defs").append("svg:linearGradient").attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%").attr("id","heat_gradient").call(function(t){t.append("svg:stop").attr("offset","0%").attr("style","stop-color:"+o+";stop-opacity:1"),t.append("svg:stop").attr("offset","100%").attr("style","stop-color:"+g+";stop-opacity:1")}),n.append("rect").attr("y",5).attr("width",f).attr("height",u).style("fill","url(#heat_gradient)"),n.append("text").attr("dx",f/2).attr("text-anchor","middle").text(d3.max(M)),n.append("text").attr("dx",f/2).attr("dy",u+20).attr("text-anchor","middle").text(d3.min(M)),n.append("text").attr("dx",(u+10)/2).attr("dy",-f-5).attr("text-anchor","middle").attr("transform","rotate(90)").text(p)
}function T(t,e){for(var n=[],r=0;r<e.length;r++)for(var a=e[r].name,i=0;i<e.length;i++)for(var o=e[i].name,l=0;l<t.length;l++){var s=t[l].source,c=t[l].target;(a==s&&o==c||a==c&&o==s)&&n.push({source:e[r],target:e[i],weight:t[l].weight,networks:t[l].networks,references:t[l].references})}return n}var C=t.edges,_=t.nodes,E=d3.select(this).selectAll("svg").data([t]).enter().append("svg");E.attr("id","figure").attr("height",h+y.top+y.bottom).attr("width",k).style("font-family",c).style("font-size",d);var M=_.map(function(t){return t.heat}),O=d3.scale.linear().domain([d3.min(M),d3.max(M)]).range([o,g]).nice(),H=k;w&&A?H-=Math.max(v,f):w?H-=v:A&&(H-=f);var L=d3.layout.force().charge(-400).linkDistance(40).size([H,h]),B=(L.drag().on("dragstart",function(t){t.fixed=!0,d3.select(this).select("circle").style("stroke-opacity",0)}),d3.scale.linear().range([0,H]),d3.scale.linear().range([0,h]),T(C,_));L.nodes(_).links(B).start();for(var I=[],F=0;F<B.length;F++)for(var D=0;D<B[F].networks.length;D++)-1==I.indexOf(B[F].networks[D])&&I.push(B[F].networks[D]);for(var N=I.length,j=E.selectAll(".link").data(B).enter().append("g"),G={},X={},F=0;F<I.length;F++){var W=I[F],P=i.network[I[F]];X[W]=!0;var Y=j.filter(function(t){return t.networks&&-1!=t.networks.indexOf(W)}).append("line").classed(W,!0).style("stroke-width",l).style("stroke",P);G[W]=Y}if(z){var R=d3.tip().attr("class","d3-tip").offset([-10,10]).html(function(t){return r(t,X)});E.call(R);var $=function(t){R.hide(t),d3.select(this).on("mouseout",function(){R.hide(t)})},V=function(t){R.show(t),d3.select("div#subnet-tooltip").insert("span",":first-child").style("cursor","pointer").style("float","right").attr("class","x").on("click",$).text("X")};j.on("mouseover",V).on("mouseout",R.hide).on("click",function(t,e){V(t),d3.select(this).on("mouseout",V),S&&n(t,e)})}else S&&j.on("click",n);var q=E.append("svg:g").selectAll("node").data(_).enter().append("svg:g").style("cursor","move").call(L.drag).on("dblclick",function(t){t.fixed=t.fixed?!1:!0,d3.select(this).select("circle").style("stroke-opacity",1)});q.append("circle").attr("r",x).attr("fill",function(t){return O(t.heat)}).style("stroke-width",1.5).style("stroke","#333"),q.append("text").attr("x",x).attr("y","10px").style("fill",s).style("fill-opacity","1").style("font-size",d).text(function(t){return t.name}),L.on("tick",function(){q.attr("transform",function(t){return t.x=Math.max(x,Math.min(H-x,t.x)),t.y=Math.max(x,Math.min(h-x,t.y)),"translate("+t.x+","+t.y+")"}),I.forEach(function(t,e){var n=l*(e-N/2);G[t].attr("x1",function(t){return t.source.x+n}).attr("y1",function(t){return t.source.y+n}).attr("x2",function(t){return t.target.x+n}).attr("y2",function(t){return t.target.y+n})})}),w&&e(),A&&a()})}var n,r,t=t||{},a=t.style||{},i=a.colorSchemes||{},o=a.cold||"rgb(102, 178, 255)",l=a.edgeWidth||1.5,s=a.fontColor||"#333",c=a.fontFamily||'"Helvetica","Arial"',d=a.fontSize||12,u=a.heatLegendHeight||110,f=a.heatLegendWidth||50,p=a.heatLegendText||"No. Mutated Samples",h=a.height||350,g=a.hot||"rgb(255, 51, 51)",y=a.margins||{bottom:0,left:0,right:0,top:0},m=a.netLegendBox||15,v=a.netLegendWidth||100,x=a.nodeRadius||10,b=a.transitionTime||500,k=a.width||350,w=!1,A=!1,z=!1,S=!1;return void 0==i.network&&(i.network={Multinet:"rgb(92, 128, 178)",iRefIndex:"rgb(140, 91, 56)",HINT:"rgb(127, 92, 159)","HINT+HI2012":"rgb(127, 92, 159)"}),e.addNetworkLegend=function(){return w=!0,e},e.addGradientLegend=function(){return A=!0,e},e.addTooltips=function(t){return z=!0,r=arguments.length?t:function(t,e){function n(t){return"<li><a href='http://www.ncbi.nlm.nih.gov/pubmed/"+t+"' target='_new'>"+t+"</a></li>"}var r="<div id='subnet-tooltip'>\n";return r+="Source: "+t.source.name+"<br/>Target: "+t.target.name+"<br/><br/>",r+="<table class='table table-condensed'>\n<tr><th>Network</th><th>PMIDs</th></tr>\n",t.networks.filter(function(t){return e[t]}).forEach(function(e){var a=t.references[e].map(n).join("\n");r+="<tr><td>"+e+"</td><td><ul style='padding-left:10px'>"+a+"</td></ul></tr>\n"}),r+"</table>\n</div>\n"},e},e.addOnClick=function(t){return S=!0,n=t,e},e}function cna_browser(t){function e(t){t.each(function(t){function e(){if(genome=G.append("rect").attr("class","genome").attr("y",k+(m-10)/2).attr("x",0).attr("width",y).attr("height",m-10).style("fill",s),geneGroups=G.selectAll(".genes").data(I).enter().append("g").attr("class","genes"),genes=geneGroups.append("rect").attr("width",function(t){return Y(t.end)-Y(t.start)}).attr("height",m).style("fill-opacity",function(t){return t.selected?1:.2}).style("fill",function(t){return t.selected?d:l}).attr("id",function(t,e){return"gene-"+e}),geneLabels=geneGroups.append("text").attr("id",function(t,e){return"gene-label-"+e}).attr("y",k+5+m/2).attr("text-anchor","middle").style("fill-opacity",function(t){return t.selected?1:0}).style("fill",u).text(function(t){return t.label}),geneGroups.on("mouseover",function(t){t.fixed||(d3.select(this).select("rect").style("fill",c),d3.select(this).select("text").style("fill-opacity",1))}).on("mouseout",function(t){t.fixed||(d3.select(this).select("rect").style("fill",function(t){return t.selected?d:l}),d3.select(this).select("text").style("fill-opacity",0))}).on("dblclick",function(t){t.fixed=t.fixed?!1:!0,t.fixed&&(d3.select(this).select("rect").style("fill",function(t){return t.selected?d:c}),d3.select(this).select("text").style("fill-opacity",1))}),intervals=G.selectAll(".intervals").data(D).enter().append("g").attr("class","intervals"),ints=intervals.append("rect").attr("fill",function(t){return S[h[t.sample]]}).attr("width",function(t){return Y(t.end,H,L)-Y(t.start,H,L)}).attr("height",5).attr("id",function(t,e){return"interval-"+e}),t.segments.length>0&&(verticalBars=G.selectAll(".vert-bar").data(I.filter(function(t){return t.selected})).enter().append("rect").attr("y",x).attr("width",function(t){return Y(t.end)-Y(t.start)}).attr("height",B-x).style("fill",d).style("fill-opacity",.5)),A){var e=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.sample+"<br/>Type: "+h[t.sample]+"<br/>Start: "+t.start+"<br/>End:    "+t.end});G.call(e),intervals.on("mouseover",function(t){e.show(t),$("div.d3-tip").css("left",d3.event.pageX-50+"px").css("top",d3.event.pageY-65+"px")}).on("mouseout",e.hide),z&&intervals.on("click",r)}else z&&intervals.on("click",r)}function a(){genes.attr("transform",function(t){return"translate("+Y(t.start)+","+k+")"}),genes.attr("width",function(t){return Y(t.end)-Y(t.start)}),geneLabels.attr("transform",function(t){d3.max([t.start,d3.max(Y.domain())]),d3.min([t.end,d3.min(Y.domain())]);return"translate("+Y(t.start+(t.end-t.start)/2)+",0)"}),t.segments.length>0&&verticalBars.attr("x",function(t){return Y(t.start)}).attr("width",function(t){return Y(t.end)-Y(t.start)})}function i(){ints.attr("transform",function(t){return"translate("+Y(t.start)+","+(k-15+t.y)+")"}).attr("width",function(t){return Y(t.end)-Y(t.start)});intervals.filter(function(t){return T[h[t.sample]]}).style("opacity",1);intervals.filter(function(t){return!T[h[t.sample]]}).style("opacity",0)}var h=t.sampleToTypes||{},C=t.gene||"",_=t.neighbors||[],E=t.segments||[],M=t.region||{},O=M.chr,H=M.minSegX,L=M.maxSegX,B=v*t.segments.length+x+k-10,I=_.map(function(t){var e=t.name==C;return{fixed:e?!0:!1,start:t.start,end:t.end,label:t.name,selected:e}}),F=new Array,D=new Array,N=new Array;E.forEach(function(t){F.push(t.sample),t.segments.forEach(function(e){D.push({gene:C,start:e.start,end:e.end,label:e.sample,sample:t.sample,dataset:h[t.sample],ty:e.ty}),N.indexOf(h[t.sample])&&N.push(h[e.sample])})}),D.sort(function(t,e){return t.dataset!=e.dataset?d3.ascending(t.dataset,e.dataset):d3.ascending(t.end-t.start,e.end-e.start)});var j=x;d3.range(0,D.length).forEach(function(t){D[t].y=j+=v}),N.sort(),N.forEach(function(t){T[t]=!0});var G=d3.select(this).selectAll("svg").data([t]).enter().append("svg"),X=M.minSegX,W=M.maxSegX,P=d3.scale.linear().domain([X,W]).range([0,y]),Y=(d3.svg.axis().scale(P).orient("bottom").ticks(5).tickSize(0).tickPadding(1.25),d3.scale.linear().domain([X,W]).range([0,y])),R=d3.behavior.zoom().x(P).scaleExtent([1,100]).on("zoom",function(){n()});G.attr("id","cna-browser").attr("height",B+g.top+g.bottom).attr("width",y).style("display","block").style("font-family",f).style("font-size",p).call(R).on("dblclick.zoom",null);var V=(G.append("rect").attr("width",y).attr("height",B).attr("class","background").style("fill",o),G.append("text").attr("x",3).attr("y",b).style("font-size",w));n=function(){{var t=R.translate(),e=t[0],n=t[1];R.scale()}e=Math.min(e,0),R.translate([e,n]);var r=d3.min(P.domain()),o=d3.max(P.domain());Y.domain([r,o]),V.text("chr"+O+": "+d3.round(r)+"-"+d3.round(o)),a(r,o),i(r,o)},e(),n()})}var n,r,t=t||{},a=t.style||{},i=a.colorSchemes||{},o=a.bgColor||"#F6F6F6",l=(a.blockColorStrongest||"#2C3E50",a.blockColorStrong||"#7F8C8D",a.blockColorMedium||"#95A5A6"),s=a.blockColorLight||"#BDC3C7",c=(a.blockColorLightest||"#ECF0F1",a.highlightColor||"#f1c40f"),d=a.selectedColor||"#E74C3C",u=a.textColorStrongest||"#2C3E50",f=(a.textColorStrong||"#34495E",a.textColorLight||"#BDC3C7",a.textColorLightest||"#ECF0F1",a.fontColor||"#333",a.fontFamily||'"Helvetica","Arial"'),p=a.fontSize||10,h=a.height||250,g=a.margins||{bottom:0,left:0,right:0,top:0},y=a.width||800,m=a.genomeHeight||25,v=a.intervalH||7,x=a.initIntervalH||50,b=a.rangeLegendY||15,k=a.rangeLegendOffset||25,w=a.rangeLegendFontSize||11,A=!1,z=!1,S=i.sampleType||{},T={};return e.width=function(t){return arguments.length?(fullWidth=t,e):y},e.height=function(t){return arguments.length?(fullHeight=t,e):h},e.addTooltips=function(){return A=!0,e},e.filterDatasets=function(t){Object.keys(t).forEach(function(e){T[e]=t[e]}),n()},e.addOnClick=function(t){return z=!0,r=t,e},e}function heatmap(t){function e(t){t.each(function(t){function e(t){return""==t||null==t?"No data":t}function c(t,e,n){d3.select("#vizHeatmapXLabel"+t.x).style("fill","#f00").style("font-weight","bold"),d3.select("#vizHeatmapYLabel"+t.y).style("fill","#f00").style("font-weight","bold"),d3.select(n).style("stroke","black").style("stroke-width",2);var r=i[t.x],a=D.indexOf(t.y),o=X(j)-X(t.value);J.attr("y1",o).attr("y2",o).style("stroke","black"),"none"==ae.style("stroke")&&ae.style("stroke","black"),"none"==ie.style("stroke")&&ie.style("stroke","black"),"none"==oe.style("stroke")&&oe.style("stroke","black"),"none"==le.style("stroke")&&le.style("stroke","black"),ae.attr("row")!=a&&(ae.attr("x1",0).attr("x2",p*F.length).attr("y1",a*f).attr("y2",a*f).style("stroke","black").style("stroke-width","1px").attr("row",a),ie.attr("x1",0).attr("x2",p*F.length).attr("y1",a*f+f).attr("y2",a*f+f).style("stroke","black").style("stroke-width","1px").attr("row",a)),oe.attr("col")!=r&&(oe.attr("x1",r*p).attr("x2",r*p).attr("y1",0).attr("y2",$.node().getBBox().height).style("stroke","black").style("stroke-width","1px").attr("col",r),le.attr("x1",r*p+p).attr("x2",r*p+p).attr("y1",0).attr("y2",$.node().getBBox().height).style("stroke","black").style("stroke-width","1px").attr("col",r))}function M(){ae.style("stroke","none"),ie.style("stroke","none"),oe.style("stroke","none"),le.style("stroke","none"),J.style("stroke","none")}function O(t,e,n){d3.select("#vizHeatmapXLabel"+t.x).style("fill","#000").style("font-weight","normal"),d3.select("#vizHeatmapYLabel"+t.y).style("fill","#000").style("font-weight","normal"),d3.select(n).style("stroke","none")}for(var H,L=d3.select(this).selectAll("svg").data([t]).enter().append("svg").attr("id","figure").attr("height",y+m.top+m.bottom).attr("width",v+m.left+m.right).style("font-family",h).style("font-size",g),B=L.append("g").attr("transform","translate("+m.left+","+m.top+")"),I=t.cells,F=t.xs,D=t.ys,N=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,G=I.length-1;G>=0;G--)H=I[G].value,N>H&&(N=H),H>j&&(j=H);var X=d3.scale.linear().domain([N,j]),W=["rgb(58, 76, 247)","rgb(0, 78, 247)","rgb(82, 137, 248)","rgb(150, 225, 250)","rgb(169, 242, 91)","rgb(170, 241, 56)","rgb(192, 243, 61)","rgb(241, 246, 72)","rgb(255, 247, 76)","rgb(245, 223, 91)","rgb(241, 214, 131)","rgb(243, 222, 182)"],P=W.length,Y=(j-N)/P,R=d3.scale.linear().domain(d3.range(N,j,Y).concat([j])).range(W),$=B.append("g").attr("class","vizHeatmap"),V=$.selectAll(".hmap-rect").data(I).enter().append("rect").attr("data-value",function(t){return t.value});V.append("title").text(function(t){return["x: "+t.x,"y: "+t.y,"value: "+t.value].join("\n")});var q=B.append("g"),U=q.append("g"),J=q.append("line");if(o=function(t){if(i={},t)var e=F.sort(function(e,n){return d3.ascending(t[e],t[n])});else e=F;e.forEach(function(t,e){i[t]=e})},o(),V.attr("x",function(t){return i[t.x]*p}).attr("y",function(t){return D.indexOf(t.y)*f}).attr("height",f).attr("width",p).style("fill",function(t){return R(t.value)}),E){var K=s.categories||[],Q=s.sampleToAnnotations||{},Z=s.annotationToColor||{},te=(Object.keys(Q),{});K.forEach(function(t,e){var n=!0,r=[],a=[];Object.keys(Q).forEach(function(t){var i=typeof Q[t][e],o=Q[t][e];n=n&&(null==o||""==o||"number"===i),""!=o&&null!=o&&(r.push(o),n&&a.push(Q[t][e]))});var i,o={min:d3.min(a),max:d3.max(a)};if(n){var l=x[_];i=d3.scale.linear().domain([o.min,o.max]).range(l).interpolate(d3.interpolateLab),i.type="linear",_+=1,_>=x.length&&(_=0)}else{var s=r.filter(function(t,e){return r.indexOf(t)==e}),c=s.map(function(e){return Z[t]&&Z[t][e]?Z[t][e]:"#"+Math.floor(16777215*Math.random()).toString(16)});i=d3.scale.ordinal().domain(s).range(c),i.type="ordinal"}te[t]=i});var ee=$.selectAll(".category-row").data(K).enter().append("g"),ne=ee.selectAll(".sample-annotation-rect").data(function(t,n){return F.map(function(t){return{x:i[t],y:n,value:e(Q[t][n]),sample:t}})}).enter().append("rect").attr("height",f/2).attr("width",p).attr("x",function(t){return t.x*p}).attr("y",function(t){return(t.y+1)*b+t.y*(f/2)+D.length*f}).style("fill",function(t){return""!=t.value&&null!=t.value?te[K[t.y]](t.value):"#333"});ne.append("title").text(function(t){return""!=t.value&&null!=t.value?t.value:"No data"})}var re=$.append("g").attr("class","vizHeatmapMouseoverLines"),ae=re.append("line"),ie=re.append("line"),oe=re.append("line"),le=re.append("line");if(T){r=d3.tip().attr("class","d3-tip").offset([-10,0]).html(a),L.call(r);var se="div.gd3-tooltip",ce=function(t){r.hide(t),d3.select(this).on("mouseout",function(){r.hide(t)}),ue(!1,!0)},de=function(t,e,n){c(t,e,n),r.show(t),d3.select(se).insert("span",":first-child").style("cursor","pointer").style("float","right").attr("class","x").on("click",ce).text("X")},ue=function(t,e){d3.select(se+" div.more-info").style("display",t?"inline":"none"),d3.select(se+" div.less-info").style("display",e?"inline":"none")},fe=function(t,e,n){de(t,e,n),ue(!0,!1),O(t,e,n),M()};V.on("mouseover",function(t,e){de(t,e,this)}).on("mouseout",function(t,e){r.hide(t,e),O(t,e,this),M()}).on("click",function(t,e){d3.select(this).on("mouseout",function(t,e){fe(t,e,this)}),fe(t,e,this),C&&n(t,e)})}else V.on("mouseover",function(t,e){c(t,e,this)}),V.on("mouseout",function(t,e){M(),O(t,e,this)}),C&&V.on("click",n);var pe=B.append("g").attr("class","vizHeatmapYLabels");if(A){var he=parseInt(g.replace("px","")),ge=D.map(function(t){return{dy:0,name:t}});E&&(ge=ge.concat(K.map(function(t,e){return{dy:(e+1)*b,name:t}})));var ye=pe.selectAll("text").data(ge).enter().append("text").attr("id",function(t,e){return"vizHeatmapYLabel"+e}).attr("text-anchor","end").attr("y",function(t,e){var n=parseInt(u.replace("px",""));return e>=D.length?t.dy+(e-D.length)*(f/2)+D.length*f+n-3:t.dy+e*f+f/2+he/2}).text(function(t){return t.name});ye.each(function(){var t=d3.select(this),e=t.text(),n=K.indexOf(e)>-1;n&&t.style("font-size",u)});var me=0;ye.each(function(){var t=d3.select(this).node().getBBox().width;me=me>t?me:t}),ye.attr("x",me),$.attr("transform","translate("+(me+2)+",0)")}var ve=B.append("g").attr("class","vizHeatmapXLabels").attr("transform","translate(0,"+$.node().getBBox().height+")");if(w)var he=parseInt(g.replace("px","")),xe=ve.selectAll("text").data(F).enter().append("text").attr("id",function(t,e){return"vizHeatmapXLabel"+e}).attr("transform",function(t,e){var n=e*p+p/2+pe.node().getBBox().width;return"translate("+n+",3)rotate(90)"}).style("fill","#95A5A6").style("font-size","10px").text(function(t){return t});if(z){var be=10>p?10:p,ke=S?d3.max([D.length*p,250]):F.length*f;X.range([0,ke]),J.attr("x1",0).attr("x2",be).attr("y1",F.length*f/2).attr("y2",F.length*f/2).style("stroke","black").style("stroke-width",2);var we=10;S?(we+=ve.node().getBBox().height+$.node().getBBox().height+10,q.attr("transform","translate(0,"+we+") rotate(-90)")):(we+=m.left+v,q.attr("transform","translate("+we+",0)"));var Ae=U.append("rect").attr("width",be).attr("height",ke).style("fill","red"),ze=U.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%");W.forEach(function(t,e){ze.append("svg:stop").attr("offset",1*e/P).attr("stop-color",t).attr("stop-opacity",1)}),Ae.style("fill","url(#gradient)"),U.append("text").attr("x",Ae.attr("height")).attr("y",Ae.attr("width")).attr("transform","rotate(90)").attr("text-anchor","end").text(k(N)),U.append("text").attr("x",0).attr("y",Ae.attr("width")).attr("transform","rotate(90)").attr("text-anchor","start").text(k(j)),S&&U.append("text").attr("x",Ae.attr("height")/2).attr("y",Ae.attr("width")).attr("transform","rotate(90)").attr("text-anchor","middle").text(t.name+" value");var Se=U.append("rect").style("fill","black");Ae.on("mousemove",function(){var t=d3.mouse(this),e=parseFloat(q.attr("transform").replace("translate(","").split(",")[1].replace(")","")),n=S?t[1]:t[1]-e,r=1-n/Ae.attr("height"),a=r*j,i=j/40,o=Ae.attr("height")/parseFloat(j),l=2*o*i,s=n-o*i;l=l+s>Ae.attr("height")?l-Math.abs(l+s-Ae.attr("height")):l,Se.attr("x",Ae.attr("x")+p).attr("y",s).attr("width",5).attr("height",l).style("fill","black"),V.style("stroke",function(t){return Math.abs(t.value-a)<i?"black":"none"}).style("stroke-width",1)}),Ae.on("mouseout",function(){V.style("stroke","none")})}L.attr("height",B.node().getBBox().height);var Te=parseFloat($.attr("transform").split("translate(")[1].split(",")[0]),Ce=($.node().getBBox().width,d3.behavior.zoom().on("zoom",function(){function t(t){return t*p+r>0}function e(e){return t(e)?1:.1}var n=Ce.translate(),r=n[0];$.attr("transform","translate("+(r+Te)+",0)");var a=ve.attr("transform").split("translate(")[1].split(",")[1].split(")")[0];ve.attr("transform","translate("+r+","+a+")"),V.style("opacity",function(t){return e(i[t.x])}),w&&xe.style("opacity",function(t){return e(i[t])}),E&&ne.style("opacity",function(t){return e(i[t.sample])})}));L.call(Ce),l=function(){V.transition().duration(d).delay(function(t){return i[t.x]}).attr("x",function(t){return i[t.x]*p}),xe.transition().duration(d).attr("transform",function(t){var e=i[t]*p+p/2+pe.node().getBBox().width;return"translate("+e+",3)rotate(90)"}),ne.attr("x",function(t){return i[t.sample]*p})}})}var n,r,a,i,o,l,s,t=t||{},c=t.style||{},d=c.animationSpeed||300,u=c.annotationFontSize||"10px",f=c.cellHeight||14,p=c.cellWidth||14,h=c.fontFamily||"sans-serif",g=c.fontSize||"10px",y=c.height||400,m=c.margins||{bottom:0,left:0,right:0,top:0},v=c.width||400,x=c.continuousScaleColors||[["#fcc5c0","#49006a"],["#ffffff","#000000"]],b=c.sampleAnnotationSpacer||5,k=d3.format(".4g"),w=!1,A=!1,z=!1,S=!0,T=!1,C=!1,_=0,E=!1;return e.addXLabels=function(){return w=!0,e},e.addYLabels=function(){return A=!0,e},e.addLegend=function(){return z=!0,e},e.addSampleAnnotations=function(t){return s=t||{},s.sampleToAnnotations&&(E=!0),e},e.addTooltips=function(t){return T=!0,a=t,r&&r.html(t),e},e.addOnClick=function(t){return C=!0,n=t,e},e.sampleOrder=function(t){return arguments.length&&(o(t),l()),i},e}
//# sourceMappingURL=dist/js/gd3.min.js.map